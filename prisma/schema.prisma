generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

enum UserRole {
  CANDIDATE
  ADMIN
}

enum ApplicationStatus {
  PENDING
  ACCEPTED
  REJECTED
}

enum DocumentType {
  TRANSCRIPT
  DIPLOMA
  IDENTITY
  VITALE
  PHOTO
  CV
  PORTFOLIO
}

model User {
  id           String        @id @default(uuid())
  authId       String        @unique
  email        String        @unique
  firstName    String
  lastName     String
  role         UserRole      @default(CANDIDATE)
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  applications Application[]

  @@map("users")
}

model Application {
  id     String @id @default(uuid())
  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  program String
  rhythm  String
  campus  String

  firstName      String
  lastName       String
  address        String
  city           String
  postalCode     String
  country        String
  email          String
  phone          String
  dateOfBirth    DateTime
  cityOfBirth    String
  countryOfBirth String
  nationality    String
  needsVisa      Boolean  @default(false)

  diplomaTitle  String
  diplomaDomain String
  diplomaYear   String
  institution   String

  language      String
  languageLevel String
  motherTongue  String

  motivationLetter String
  discoveryChannel String
  discoveryDetails String

  hasDisability   Boolean           @default(false)
  status          ApplicationStatus @default(PENDING)
  statusUpdatedAt DateTime?
  submittedAt     DateTime          @default(now())
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt

  documents ApplicationDocument[]

  @@map("applications")
}

model ApplicationDocument {
  id            String      @id @default(uuid())
  applicationId String
  application   Application @relation(fields: [applicationId], references: [id], onDelete: Cascade)

  type        DocumentType
  fileName    String
  storagePath String
  mimeType    String
  fileSize    Int
  createdAt   DateTime     @default(now())

  @@map("application_documents")
}